#!/usr/bin/env ruby
# dscmp <query> - Compare query results in both warehouses

require "optimist"

opts = Optimist.options do
  opt :csv, type: :boolean, default: false
  opt :finance, "Use finance warehouses", type: :boolean, default: false
end

warehouses = if opts[:finance]
               %w(redshift_finance snowflake_finance)
             else
               %w(redshift snowflake)
             end

warehouses.each do |warehouse|
  command = %Q|dsquery #{opts[:csv] ? '--csv ' : ''}--warehouse #{warehouse} --query "#{ARGV * ' '}"|
  puts command
  system command
end
