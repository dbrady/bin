#!/bin/sh
# dnsmasq-asplain


echo "----------------------------------------------------------------------"
echo ""
echo "dnsmasq-asplain"
echo ""
echo "Hi. This file is here because I am TOTALLY going to forget this stuff. A lot of"
echo "this can be found at http://passingcuriosity.com/2013/dnsmasq-dev-osx/"
echo ""
echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo "TL;DR:"
echo ""
echo "(Read this only if dnsmasq is all set up and ready to go)"
echo ""
echo "config is at /usr/local/etc/dnsmasq.conf. Restart the service after editing with"
echo ""
echo "sudo launchtl stop homebrew.mxcl.dnsmasq"
echo "sudo launchtl start homebrew.mxcl.dnsmasq"
echo ""
echo "NOTE: launchctl doesn't work from inside tmux/tmate."
echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
echo ""
echo "Longer version: I'm using dnsmasq to route dev domains back to my vagrant VM. It"
echo "is at 198.162.33.10, by the way, and it should be running with 'vagrant up' and"
echo "you can connect to it with 'vagrant ssh'."
echo ""
echo "--------------------"
echo "Caveat: dnsmasq has been notoriously hard to set up on my machine--Chris Everest"
echo "gave up on it after half an hour last year-- and I am writing this help"
echo "file/note to myself before successfully getting it to work. So if I decide I"
echo "need to punt, the cheap and easy way to get around this is to just jam in all"
echo "these hosts into /etc/hosts:"
echo ""
echo "192.168.33.10 admin.dev.cmmint.net"
echo "192.168.33.10 central.dev.cmmint.net"
echo "192.168.33.10 cmm.dev.cmmint.net"
echo "192.168.33.10 api.dev.cmmint.net"
echo "192.168.33.10 central.dev.cmmint.net"
echo "192.168.33.10 claims.dev.cmmint.net"
echo ""
echo "Note: there's a bug in OSX that makes DNS resolution reeeeeally slow if you"
echo "stick these all on one line, so don't do that."
echo "--------------------"
echo ""
echo "Okay, so dnsmasq has some extra info associated with it. You can dig most of"
echo "this up by typing 'brew info dnsmasq', but here are my notes:"
echo ""
echo "1. Configure dnsmasq by editing /usr/local/etc/dnsmasq.conf. The whole file"
echo "should be commented out except for one line, which will need to be added:"
echo ""
echo "address=/.dev.cmmint.net/192.168.33.10"
echo ""
echo "If this file isn't present, copy in the example file with"
echo ""
echo "cp /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf"
echo ""
echo "2. To have launchd start dnsmasq at startup:"
echo "    sudo cp -fv /usr/local/opt/dnsmasq/*.plist /Library/LaunchDaemons"
echo "    sudo chown root /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist"
echo ""
echo "3. Then to load dnsmasq now:"
echo "    sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist"
